<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earth-Brain Resonance Visualization</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; color: #fff; font-family: Arial, sans-serif; }
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background-color: rgba(0,0,0,0.7);
            border-radius: 5px;
            font-size: 12px;
            max-width: 300px;
        }
        #controls {
            position: absolute;
            bottom: 10px;
            left: 10px;
            padding: 10px;
            background-color: rgba(0,0,0,0.7);
            border-radius: 5px;
        }
        label, button { display: block; margin-bottom: 5px; }
        input[type="range"] { width: 200px; }
    </style>
</head>
<body>
    <div id="info">
        <h2>Earth-Brain Resonance</h2>
        <p>Visualizing the speculative concept of resonant coupling between Earth's Schumann Resonance (~7.83 Hz) and human brainwaves (Theta range 4-8 Hz).</p>
        <p>
            <strong>Earth (Schumann):</strong> <span id="earthFreq">7.83</span> Hz<br>
            <strong>Brain (Theta):</strong> <span id="brainFreq">6.00</span> Hz
        </p>
        <p>
            <strong>Resonance Strength:</strong> <span id="resonanceStrength">0.00</span>
        </p>
        <p><em>Use mouse to rotate. Scroll to zoom.</em></p>
    </div>

    <div id="controls">
        <label for="brainFreqSlider">Brain Frequency (Hz): <span id="brainFreqSliderVal">6.00</span></label>
        <input type="range" id="brainFreqSlider" min="4" max="12" value="6" step="0.01">

        <label for="couplingSlider">Coupling Strength (κ): <span id="couplingSliderVal">0.1</span></label>
        <input type="range" id="couplingSlider" min="0" max="1" value="0.1" step="0.01">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        let scene, camera, renderer, controls;
        let earth, brain, earthAura, brainAura, resonanceField;
        let time = 0;

        // --- Parameters from your model ---
        const EARTH_FREQ = 7.83; // f_E
        let brainFreq = 6.0;     // f_B
        let couplingStrength = 0.1; // κ

        // --- DOM Elements for UI ---
        const earthFreqDisplay = document.getElementById('earthFreq');
        const brainFreqDisplay = document.getElementById('brainFreq');
        const resonanceStrengthDisplay = document.getElementById('resonanceStrength');
        const brainFreqSlider = document.getElementById('brainFreqSlider');
        const brainFreqSliderVal = document.getElementById('brainFreqSliderVal');
        const couplingSlider = document.getElementById('couplingSlider');
        const couplingSliderVal = document.getElementById('couplingSliderVal');

        init();
        animate();

        function init() {
            // Scene
            scene = new THREE.Scene();

            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 15;
            camera.position.y = 5;

            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setClearColor(0x000000);
            document.body.appendChild(renderer.domElement);

            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xaaaaaa);
            scene.add(ambientLight);
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.7);
            directionalLight.position.set(5, 10, 7.5);
            scene.add(directionalLight);

            // --- Earth Object ---
            const earthGeometry = new THREE.SphereGeometry(3, 32, 32);
            // Simple blue material for Earth
            const earthMaterial = new THREE.MeshPhongMaterial({ color: 0x2266dd, emissive: 0x001133 });
            earth = new THREE.Mesh(earthGeometry, earthMaterial);
            earth.position.x = -5;
            scene.add(earth);

            // Earth Aura (representing Schumann Resonance)
            const auraMaterialEarth = new THREE.MeshBasicMaterial({
                color: 0x00ffff,
                transparent: true,
                opacity: 0.3,
                side: THREE.DoubleSide
            });
            earthAura = new THREE.Mesh(new THREE.SphereGeometry(3.5, 32, 32), auraMaterialEarth);
            earth.add(earthAura); // Add aura as a child of Earth

            // --- Brain Object ---
            const brainGeometry = new THREE.SphereGeometry(1.5, 32, 32); // Simplified brain
            // Pinkish material for Brain
            const brainMaterial = new THREE.MeshPhongMaterial({ color: 0xff88aa, emissive: 0x551122 });
            brain = new THREE.Mesh(brainGeometry, brainMaterial);
            brain.position.x = 5;
            scene.add(brain);

            // Brain Aura (representing Theta Waves)
            const auraMaterialBrain = new THREE.MeshBasicMaterial({
                color: 0xff00ff,
                transparent: true,
                opacity: 0.3,
                side: THREE.DoubleSide
            });
            brainAura = new THREE.Mesh(new THREE.SphereGeometry(1.8, 32, 32), auraMaterialBrain);
            brain.add(brainAura); // Add aura as a child of Brain

            // --- Resonance Field "Plane" ---
            // A dynamic, somewhat transparent plane/tube connecting them
            // For simplicity, let's use a cylinder that scales with resonance
            const fieldGeometry = new THREE.CylinderGeometry(0.1, 0.1, 1, 16, 1, true); // radiusTop, radiusBottom, height, radialSegments, heightSegments, openEnded
            const fieldMaterial = new THREE.MeshBasicMaterial({
                color: 0xccffcc,
                transparent: true,
                opacity: 0, // Start invisible
                wireframe: true,
                side: THREE.DoubleSide
            });
            resonanceField = new THREE.Mesh(fieldGeometry, fieldMaterial);
            scene.add(resonanceField);


            // --- UI Event Listeners ---
            brainFreqSlider.addEventListener('input', (event) => {
                brainFreq = parseFloat(event.target.value);
                brainFreqDisplay.textContent = brainFreq.toFixed(2);
                brainFreqSliderVal.textContent = brainFreq.toFixed(2);
            });
            couplingSlider.addEventListener('input', (event) => {
                couplingStrength = parseFloat(event.target.value);
                couplingSliderVal.textContent = couplingStrength.toFixed(2);
            });


            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
        }

        function updateResonanceField() {
            // Position the field between Earth and Brain
            const midpoint = new THREE.Vector3().addVectors(earth.position, brain.position).multiplyScalar(0.5);
            resonanceField.position.copy(midpoint);

            // Align the field
            const direction = new THREE.Vector3().subVectors(brain.position, earth.position);
            resonanceField.quaternion.setFromUnitVectors(new THREE.Vector3(0, 1, 0), direction.clone().normalize());
            resonanceField.scale.y = direction.length(); // Set height to distance
        }


        function animate() {
            requestAnimationFrame(animate);
            time += 0.016; // Approximate time delta (60 FPS)

            // --- Oscillations ---
            // Earth's Schumann Resonance
            const earthOscillation = Math.sin(2 * Math.PI * EARTH_FREQ * time);
            earthAura.scale.setScalar(1 + 0.1 * earthOscillation);
            earthAura.material.opacity = 0.2 + 0.2 * (1 + earthOscillation) / 2;

            // Brain's Theta Wave
            const brainOscillation = Math.sin(2 * Math.PI * brainFreq * time);
            brainAura.scale.setScalar(1 + 0.1 * brainOscillation);
            brainAura.material.opacity = 0.2 + 0.2 * (1 + brainOscillation) / 2;


            // --- Resonance Calculation (Simplified) ---
            // Calculate detuning
            const detuning = Math.abs(EARTH_FREQ - brainFreq);

            // Resonance strength: higher when frequencies are closer and coupling is strong
            // Using a Gaussian-like function for frequency matching
            const freqMatchFactor = Math.exp(-Math.pow(detuning, 2) / (2 * Math.pow(0.5, 2))); // Sigma=0.5 Hz for "closeness"
            let currentResonanceStrength = couplingStrength * freqMatchFactor;

            // If frequencies are very close, simulate phase locking effect by "pulling" brain freq slightly
            // This is a conceptual visual effect, not the Kuramoto model simulation
            let phaseLockEffect = 0;
            if (detuning < 0.2 && couplingStrength > 0.5) { // If very close and strong coupling
                // Add a subtle "wobble" or synchronized pulse to the resonance field
                phaseLockEffect = Math.sin(2 * Math.PI * EARTH_FREQ * time + Math.PI/2) * 0.5 + 0.5; // In phase with Earth
                resonanceField.material.color.setHSL(0.33, 1, 0.5 + 0.2 * phaseLockEffect); // Greenish pulse
            } else {
                resonanceField.material.color.setHex(0xccffcc); // Default color
            }

            // Update resonance field visual
            updateResonanceField();
            resonanceField.material.opacity = currentResonanceStrength * 0.7; // Max opacity 0.7
            resonanceField.scale.x = resonanceField.scale.z = 0.1 + currentResonanceStrength * 1.5 + phaseLockEffect * 0.3;


            // Update UI
            resonanceStrengthDisplay.textContent = currentResonanceStrength.toFixed(2);

            controls.update();
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

    </script>
</body>
</html>
